<div class="d-flex flex-column" cdkTrapFocus="true" *ngIf="keyResult">
  <div class="d-flex justify-content-between">
    <h1 class="mb-2 title">{{ keyResult.title }}</h1>
  </div>
  <div class="keyresult-header d-flex justify-content-between mb-3">
    <div>
      {{ "KEY_RESULT_Type." + keyResult.keyResultType | translate }}
    </div>
    <div class="d-flex align-items-center">
      <img src="assets/icons/person-icon.svg" width="10" height="10" class="me-1" alt="person icon" />
      <p>{{ keyResult.owner.firstname }} {{ keyResult.owner.lastname }}</p>
    </div>
    <div class="d-flex flex-row">
      <p>{{ keyResult.objective.quarter.startDate | date: "dd.MM.yyy" }} -</p>
      <p>{{ keyResult.objective.quarter.endDate | date: "dd.MM.yyy" }}</p>
    </div>
  </div>
  <div class="d-flex justify-content-between mb-2 align-items-center">
    <div>
      <p class="text-small">Confidence</p>
      <app-confidence
        *ngIf="keyResult.lastCheckIn"
        [checkIn]="keyResult.lastCheckIn!"
        [edit]="false"
        [backgroundColor]="'#F5F5F5'"
      ></app-confidence>
    </div>
  </div>
  <div class="d-flex gap-4 mb-5 flex-row jus">
    <ng-container *ngIf="keyResult.keyResultType == 'metric'">
      <p class="keyResult-detail-attribute-show rounded-3 p-1">
        Einheit: {{ castToMetric(keyResult).unit || "Keine" }}
      </p>
      <p class="keyResult-detail-attribute-show rounded-3 p-1">
        Baseline: {{ castToMetric(keyResult).baseline || "0" }}
      </p>
      <p class="keyResult-detail-attribute-show rounded-3 p-1">
        Stretch Goal: {{ castToMetric(keyResult).stretchGoal || "100" }}
      </p>
    </ng-container>

    <ng-container *ngIf="keyResult.keyResultType == 'ordinal'">
      <div class="col-4 h-auto">
        <p class="ordinal-zone-title">Commit</p>
        <div class="keyResult-detail-attribute-show p-3">{{ castToOrdinal(keyResult).commitZone || "Keine" }}</div>
      </div>
      <div class="col-4 h-auto">
        <p class="ordinal-zone-title">Target</p>
        <p class="keyResult-detail-attribute-show p-3">{{ castToOrdinal(keyResult).targetZone || "Keine" }}</p>
      </div>
      <div class="col-4 h-auto">
        <p class="ordinal-zone-title">Stretch</p>
        <p class="keyResult-detail-attribute-show p-3">{{ castToOrdinal(keyResult).stretchZone || "Keine" }}</p>
      </div>
    </ng-container>
  </div>
  <div *ngIf="keyResult.lastCheckIn?.modifiedOn" class="mb-3">
    <h2 class="sub-title-keyresult fw-bold mb-2">
      Letztes Check-in ({{ keyResult.lastCheckIn?.modifiedOn | date: "dd.MM.yyy" }})
    </h2>
    <p>{{ keyResult.lastCheckIn?.changeInfo }}</p>
  </div>
  <div *ngIf="!keyResult.lastCheckIn?.modifiedOn && keyResult.lastCheckIn?.createdOn" class="mb-3">
    <h2 class="sub-title-keyresult fw-bold mb-2">
      Letztes Check-in ({{ keyResult.lastCheckIn?.createdOn | date: "dd.MM.yyy" }})
    </h2>
    <p>{{ keyResult.lastCheckIn?.changeInfo }}</p>
  </div>
  <span class="d-flex justify-content-start mb-3">
    <button *ngIf="keyResult.lastCheckIn" class="add-button" mat-button (click)="checkInHistory()">
      Alle Check-ins anzeigen
    </button>
  </span>

  <div class="mb-3">
    <h2 class="sub-title-keyresult fw-bold">Beschrieb</h2>
    <p>{{ keyResult.description }}</p>
  </div>
  <div class="d-flex align-items-center flex-row-reverse justify-content-end gap-3">
    <button class="add-button" mat-button (click)="openEditKeyResultDialog()">Key Result bearbeiten</button>
    <button mat-flat-button color="primary" (click)="openCheckInForm()">Check-in erfassen</button>
  </div>
</div>
