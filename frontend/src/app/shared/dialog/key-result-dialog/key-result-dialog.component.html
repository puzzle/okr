<div mat-dialog-content class="dialog">
  <div class="d-flex justify-content-between align-items-center">
    <p class="title">Key Result {{ data.keyResult ? "bearbeiten" : "erfassen" }}</p>
    <button data-test-id="closeDrawer" mat-dialog-close mat-icon-button>
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <form (ngSubmit)="saveKeyResult()" [formGroup]="keyResultForm" class="d-flex flex-column flex-wrap container p-0">
    <div class="d-flex flex-column gap-2 col-12">
      <label for="title" class="text-black">Titel</label>
      <textarea [attr.data-testId]="'titleInput'" class="input-fields" formControlName="title" id="title"></textarea>
      <div *ngIf="isTouchedOrDirty('title')">
        <mat-error *ngFor="let errorKey of getErrorKeysOfFormField('title')">
          {{ errorMessages[errorKey.toUpperCase()] }}
        </mat-error>
      </div>
    </div>

    <div class="mt-2">
      <app-keyresult-type
        [keyresult]="data.keyResult"
        [keyResultForm]="keyResultForm"
        (newKeyresultEvent)="saveEmittedData($event)"
      ></app-keyresult-type>
    </div>

    <div class="d-flex flex-column gap-2 col-12">
      <label>Owner</label>
      <input
        [attr.data-testId]="'ownerInput'"
        [matAutocomplete]="auto"
        formControlName="owner"
        class="input-fields owner-input"
      />
      <mat-autocomplete #auto="matAutocomplete" [displayWith]="getUserNameById.bind(this)">
        <mat-option *ngFor="let user of filteredUsers$ | async" [value]="user">
          {{ user.firstname + " " + user.lastname }}
        </mat-option>
      </mat-autocomplete>
      <div *ngIf="validOwner()">
        <mat-error> Du musst einen Owner auswählen </mat-error>
      </div>
    </div>

    <div class="d-flex flex-column gap-2 col-12">
      <label for="title" class="text-black">Beschreibung (optional)</label>
      <textarea [attr.data-testId]="'descriptionInput'" class="input-fields" formControlName="description"></textarea>
      <div *ngIf="isTouchedOrDirty('description')">
        <mat-error *ngFor="let errorKey of getErrorKeysOfFormField('description')">
          {{ errorMessages[errorKey.toUpperCase()] }}
        </mat-error>
      </div>
    </div>
  </form>

  <div class="d-flex justify-content-between p-0" mat-dialog-actions>
    <span>
      <button
        [attr.data-testId]="'submit'"
        type="submit"
        (click)="saveKeyResult()"
        [disabled]="keyResultForm.invalid"
        color="primary"
        mat-flat-button
      >
        Speichern
      </button>
      <button
        *ngIf="!data.keyResult"
        [attr.data-testId]="'saveAndNew'"
        (click)="openNew()"
        mat-stroked-button
        [disabled]="keyResultForm.invalid"
      >
        Speichern & Neu
      </button>
      <button mat-button mat-dialog-close color="primary">Abbrechen</button>
    </span>
    <button
      *ngIf="this.data.keyResult"
      [attr.data-testId]="'delete'"
      mat-button
      color="primary"
      (click)="deleteKeyResult()"
    >
      Key Result löschen
    </button>
  </div>
</div>
