<div
  (click)="openObjectiveDetail()"
  (keydown.enter)="openObjectiveDetail()"
  *ngIf="objective$ | async as objective"
  [attr.data-testId]="'objective'"
  class="objective rounded-3 bg-white w-100"
  tabindex="0"
>
  <div class="row mx-1">
    <section class="d-flex mb-3 mt-3 justify-content-between">
      <section class="d-flex gap-2 align-items-start">
        <img
          (click)="$event.stopPropagation()"
          [attr.data-testId]="'objective-state'"
          [src]="'assets/icons/' + objective.state"
          alt="The objectives state"
          class="icon"
          matTooltip="{{ getStateTooltip() + ' ' + formatObjectiveState(objective.state) }}"
          matTooltipPosition="above"
        />
        <header class="title">{{ objective.title }}</header>
      </section>
      <button
        #menuButton
        *ngIf="isWritable"
        class="icon-button three-dot-menu"
        [matMenuTriggerFor]="objectiveMenu"
        (click)="$event.stopPropagation(); getMenu()"
        (keydown.enter)="$event.stopPropagation()"
        [attr.data-testId]="'three-dot-menu'"
      >
        <mat-icon>more_vert</mat-icon>
      </button>
    </section>

    <div class="d-flex px-3 gap-3 flex-column">
      <app-keyresult
        *ngFor="let keyResult of objective.keyResults; trackBy: trackByFn"
        class="border-0 p-0"
        (click)="$event.stopPropagation()"
        (keydown.enter)="$event.stopPropagation()"
        [keyResult]="keyResult"
        [attr.data-testId]="'keyresult'"
      ></app-keyresult>
    </div>

    <section class="p-0 py-2 m-0">
      <button
        *ngIf="!isComplete && isWritable"
        mat-button
        color="primary"
        class="fw-bold"
        [attr.data-testId]="'add-keyResult'"
        (click)="openAddKeyResultDialog(); $event.stopPropagation()"
        (keydown.enter)="$event.stopPropagation()"
      >
        <span class="d-flex align-items-center add-text">
          <img alt="Add key-result button" class="add-cross-button" src="assets/icons/new-icon.svg" />
          Key Result hinzuf√ºgen
        </span>
      </button>
    </section>
  </div>
</div>
<mat-menu
  #objectiveMenu="matMenu"
  [class]="'objective-three-dot-menu'"
  class="pt-2 pb-2"
  xPosition="before"
  yPosition="below"
>
  <button
    (click)="redirect(menuEntry)"
    *ngFor="let menuEntry of menuEntries"
    [attr.data-testId]="'objective-menu'"
    class="objective-menu-option"
    mat-menu-item
  >
    {{ menuEntry.displayName }}
  </button>
</mat-menu>
