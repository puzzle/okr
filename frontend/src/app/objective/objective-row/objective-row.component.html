<mat-expansion-panel
  [expanded]="isSelected"
  (closed)="removeObjectiveSelection(this.objective.id!)"
  (opened)="getKeyResults(this.objective.id!)"
>
  <mat-expansion-panel-header [collapsedHeight]="'auto'" [expandedHeight]="'auto'">
    <mat-panel-title class="objective-title">{{ this.objective!.title }}</mat-panel-title>
    <mat-panel-description class="d-flex space-between">
      <div class="d-flex w-50 margin-left">
        <div class="w-100" id="progressContainer">
          <span id="progressSpan" [ngClass]="objective!.progress === 0 ? 'key red-progress' : 'key'">{{
            objective!.progress != null ? objective!.progress + "%" : "-"
          }}</span>
          <app-progress-bar
            [value]="objective!.progress! != null ? objective!.progress! : 0"
            [colorLow]="'#FF1A0C'"
            [colorMiddle]="'#FFA012'"
            [colorHigh]="'#29DF0B'"
            [limitLow]="30"
            [limitHigh]="70"
          >
          </app-progress-bar>
        </div>
        <button
          (click)="$event.stopPropagation()"
          [matMenuTriggerFor]="objectiveMenu"
          aria-label="Button to edit objectives"
          mat-icon-button
        >
          <mat-icon class="pointer">more_vert</mat-icon>
        </button>
      </div>

      <mat-menu #objectiveMenu="matMenu" class="matMenu" yPosition="above">
        <button id="menu-entries" *ngFor="let menuEntry of menuEntries" (click)="redirect(menuEntry)" mat-menu-item>
          <span>{{ menuEntry.displayName }}</span>
        </button>
      </mat-menu>
    </mat-panel-description>
  </mat-expansion-panel-header>
  <app-objective-detail [objective]="objective" [keyResultList]="keyResultList"></app-objective-detail>
  <mat-accordion class="keyresult-row" *ngFor="let keyResult of keyResultList | async">
    <app-keyresult-row
      (onKeyresultListUpdate)="removeKeyResultFromListAndReloadObjective($event)"
      [keyResult]="keyResult"
      [objectiveId]="objective.id!"
    >
    </app-keyresult-row>
  </mat-accordion>
  <button
    id="add-keyresult-button"
    class="create-button"
    mat-stroked-button
    color="primary"
    (click)="routeService.navigate('objective/' + this.objective.id + '/keyresult/new')"
  >
    Key Result hinzuf√ºgen
  </button>
</mat-expansion-panel>
