<div
  (click)="openObjectiveDetail()"
  (keydown.enter)="openObjectiveDetail()"
  class="objective rounded-3 bg-white"
  tabindex="0"
  [attr.data-testId]="'objective'"
  *ngIf="objective$ | async as objective"
>
  <div class="row mx-1">
    <section class="d-flex mb-3 mt-3">
      <img
        alt="The objectives state"
        (click)="$event.stopPropagation()"
        matTooltip="The objectives state is {{ objective.state.split('-')[0] | uppercase }}"
        matTooltipPosition="above"
        [attr.data-testId]="'objective-state'"
        class="icon col-1 ms-1 me-2"
        [src]="'assets/icons/' + objective.state"
      />
      <header class="title col-10 ps-2">{{ objective.title }}</header>
      <button
        *ngIf="isWritable"
        class="icon-button three-dot-menu"
        [matMenuTriggerFor]="objectiveMenu"
        (click)="$event.stopPropagation(); getMenu()"
        data-testid="objective-menu"
        (keydown.enter)="$event.stopPropagation()"
        [attr.data-testId]="'three-dot-menu'"
      >
        <mat-icon>more_vert</mat-icon>
      </button>
    </section>
    <section class="d-flex gap-3 px-3 flex-column">
      <app-keyresult
        *ngFor="let keyResult of objective.keyResults; trackBy: trackByFn"
        class="border-0 p-0"
        (click)="$event.stopPropagation()"
        (keydown.enter)="$event.stopPropagation()"
        [keyResult]="keyResult"
        [attr.data-testId]="'keyresult'"
      ></app-keyresult>
    </section>
    <section class="p-0 py-3 m-0">
      <button
        *ngIf="!isComplete && isWritable"
        mat-button
        color="primary"
        class="fw-bold"
        [attr.data-testId]="'add-keyResult'"
        (click)="openAddKeyResultDialog(); $event.stopPropagation()"
        (keydown.enter)="$event.stopPropagation()"
      >
        <span class="d-flex align-items-center add-keyresult-text">
          <img src="assets/icons/new-icon.svg" alt="Add key-result button" />
          Key Result hinzuf√ºgen
        </span>
      </button>
    </section>
  </div>
</div>
<mat-menu
  class="pt-2 pb-2"
  #objectiveMenu="matMenu"
  xPosition="before"
  yPosition="below"
  [class]="'objective-three-dot-menu'"
>
  <button
    mat-menu-item
    class="objective-menu-option"
    [attr.data-testId]="'objective-menu'"
    (click)="redirect(menuEntry)"
    *ngFor="let menuEntry of menuEntries"
  >
    {{ menuEntry.displayName }}
  </button>
</mat-menu>
